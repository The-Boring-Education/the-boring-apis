"use strict";(()=>{var e={};e.id=5832,e.ids=[5832],e.modules={8097:e=>{e.exports=require("@sentry/nextjs")},2167:e=>{e.exports=require("axios")},3582:e=>{e.exports=require("cors")},1185:e=>{e.exports=require("mongoose")},1649:e=>{e.exports=require("next-auth/react")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3160:e=>{e.exports=require("next/dist/lib/import-next-warning")},5828:e=>{e.exports=require("uuid")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},3048:(e,t,s)=>{s.r(t),s.d(t,{config:()=>m,default:()=>l,routeModule:()=>x});var r={};s.r(r),s.d(r,{default:()=>d});var a=s(1802),i=s(7153),u=s(6249),o=s(5912),n=s(3300),p=s(5166),c=s(3506);let handler=async(e,t)=>{await (0,c.uD)();let{method:s}=e;switch(s){case"POST":return handleCreateSubscription(e,t);case"GET":return handleGetSubscription(e,t);default:return t.status(o.uT.BAD_REQUEST).json((0,p.OF)({status:!1,message:`Method ${e.method} Not Allowed`}))}},handleCreateSubscription=async(e,t)=>{try{let s;let{userId:r,type:a,amount:i,duration:u}=e.body;if(!r||!a||!i||!u)return t.status(o.uT.BAD_REQUEST).json((0,p.OF)({status:!1,message:"Required fields: userId, type, amount, duration"}));"Lifetime"===a?s=new Date("2099-12-31"):(s=new Date).setMonth(s.getMonth()+u);let c=["InterviewQuestions","SystemDesignResources","DSAResources","ResumeWorkshop","JobApplicationWorkshop"];"Lifetime"===a&&c.push("ColdEmailAutomation","LinkedInAutomation");let d=await n.PrepYatraSubscription.create({userId:r,type:a,amount:i,duration:u,expiryDate:s,features:c});return await n.User.updateOne({userId:r},{subscriptionStatus:"Active",subscriptionExpiry:s}),t.status(o.uT.OKAY).json((0,p.OF)({status:!0,data:d,message:"Subscription created successfully"}))}catch(e){return console.error("Error creating subscription:",e),t.status(o.uT.INTERNAL_SERVER_ERROR).json((0,p.OF)({status:!1,message:"Failed to create subscription",error:e.message}))}},handleGetSubscription=async(e,t)=>{try{let{userId:s}=e.query;if(!s)return t.status(o.uT.BAD_REQUEST).json((0,p.OF)({status:!1,message:"User ID is required"}));let r=await n.PrepYatraSubscription.findOne({userId:s,isActive:!0,expiryDate:{$gt:new Date}}).sort({createdAt:-1}),a=await n.User.findOne({userId:s});return t.status(o.uT.OKAY).json((0,p.OF)({status:!0,data:{subscription:r,user:a,hasActiveSubscription:!!r},message:"Subscription status retrieved successfully"}))}catch(e){return console.error("Error getting subscription:",e),t.status(o.uT.INTERNAL_SERVER_ERROR).json((0,p.OF)({status:!1,message:"Failed to get subscription status",error:e.message}))}},d=handler,l=(0,u.l)(r,"default"),m=(0,u.l)(r,"config"),x=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/v1/prepyatra/subscription",pathname:"/api/v1/prepyatra/subscription",bundlePath:"",filename:""},userland:r})},3506:(e,t,s)=>{s.d(t,{D0:()=>r.D0,uD:()=>r.uD,xM:()=>r.xM});var r=s(7750)}};var t=require("../../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[4222,5912,5166,9276,7750,3300],()=>__webpack_exec__(3048));module.exports=s})();