"use strict";(()=>{var e={};e.id=9606,e.ids=[9606],e.modules={8097:e=>{e.exports=require("@sentry/nextjs")},2167:e=>{e.exports=require("axios")},3582:e=>{e.exports=require("cors")},1185:e=>{e.exports=require("mongoose")},1649:e=>{e.exports=require("next-auth/react")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3160:e=>{e.exports=require("next/dist/lib/import-next-warning")},5828:e=>{e.exports=require("uuid")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},7182:(e,t,r)=>{r.r(t),r.d(t,{config:()=>f,default:()=>p,routeModule:()=>h});var a={};r.r(a),r.d(a,{default:()=>l});var s=r(1802),i=r(7153),u=r(6249),d=r(5912),n=r(3300),o=r(5166),c=r(7750);let handler=async(e,t)=>{if(await (0,o.D0)(e,t),"OPTIONS"===e.method){t.status(200).end();return}await (0,c.uD)();let{method:r,query:a}=e,{type:s,userId:i,programId:u}=a;switch(r){case"POST":return handleAddACertificate(e,t);case"GET":return handleGetACertificate(e,t,s,i,u);default:return t.status(d.uT.BAD_REQUEST).json((0,o.OF)({status:!1,message:`Method ${e.method} Not Allowed`}))}},handleAddACertificate=async(e,t)=>{try{let r=e.body,{data:a}=await (0,n.checkCertificateExistForAProgram)(r.type,r.userId,r.programId);if(a)return t.status(d.uT.OKAY).json((0,o.OF)({status:!0,message:"Certificate already exists",data:a}));let{data:s,error:i}=await (0,n.addACertificateToDB)(r);if("SHIKSHA"===r.type&&(await (0,n.updateCertificateToUserShikshaCourseDoc)(r.userId,r.programId,s._id.toString()),await (0,n.updateUserPointsInDB)(r.userId,"COMPLETE_COURSE_CERTIFICATE")),i)return t.status(d.uT.BAD_REQUEST).json((0,o.OF)({status:!1,message:"Failed while adding Certificate",error:i}));return t.status(d.uT.OKAY).json((0,o.OF)({status:!0,data:s,message:"Certificate added successfully"}))}catch(e){return t.status(d.uT.INTERNAL_SERVER_ERROR).json((0,o.OF)({status:!1,message:"Failed while adding Certificate",error:e}))}},handleGetACertificate=async(e,t,r,a,s)=>{try{let e=[];if(a||e.push("User ID"),r||e.push("Certificate type"),s||e.push("Program ID"),e.length>0)return t.status(d.uT.BAD_REQUEST).json((0,o.OF)({status:!1,message:`Missing required fields: ${e.join(", ")}`}));let{data:i}=await (0,n.checkCertificateExistForAProgram)(r,a,s);if(i)return t.status(d.uT.OKAY).json((0,o.OF)({status:!0,data:i}));return t.status(d.uT.NOT_FOUND).json((0,o.OF)({status:!1,message:"Certificate not found"}))}catch(e){return t.status(d.uT.INTERNAL_SERVER_ERROR).json((0,o.OF)({status:!1,message:"Failed while fetching Certificate",error:e}))}},l=handler,p=(0,u.l)(a,"default"),f=(0,u.l)(a,"config"),h=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/v1/certificate",pathname:"/api/v1/certificate",bundlePath:"",filename:""},userland:a})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,5912,5166,9276,7750,3300],()=>__webpack_exec__(7182));module.exports=r})();