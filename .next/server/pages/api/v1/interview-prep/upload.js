"use strict";(()=>{var e={};e.id=7225,e.ids=[7225],e.modules={8097:e=>{e.exports=require("@sentry/nextjs")},2167:e=>{e.exports=require("axios")},3582:e=>{e.exports=require("cors")},1185:e=>{e.exports=require("mongoose")},1649:e=>{e.exports=require("next-auth/react")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3160:e=>{e.exports=require("next/dist/lib/import-next-warning")},5828:e=>{e.exports=require("uuid")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},1593:(e,s,t)=>{t.r(s),t.d(s,{config:()=>p,default:()=>d,routeModule:()=>c});var r={};t.r(r),t.d(r,{default:()=>handler});var n=t(1802),o=t(7153),a=t(6249),i=t(2167),u=t.n(i),l=t(3300);async function handler(e,s){if("POST"!==e.method)return s.status(405).json({success:!1,message:"Method not allowed"});try{let{sessionId:t,name:r,description:n,isPremium:o,price:a,coverImageURL:i}=e.body;if(!t)return s.status(400).json({success:!1,message:"Session ID is required"});let d=process.env.AGENTS_API_BASE,p=await u().get(`${d}/interview/session/${t}/progress`);if(!p.data)return s.status(404).json({success:!1,message:"Session not found"});let c=p.data;if("completed"!==c.status)return s.status(400).json({success:!1,message:"Can only upload completed sessions"});if(!c.sheetData||!c.sheetData.questions)return s.status(400).json({success:!1,message:"No sheet data found in session"});let g=c.sheetData,m={title:r||g.name||`${c.topic} Interview Questions`,description:n||g.description||`Comprehensive ${c.topic} interview questions with detailed answers`,slug:g.slug||c.topic.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),coverImageURL:i||g.cover_image_url||"https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=800",liveOn:new Date().toISOString(),roadmap:c.roadmap||"Tech",isPremium:o||!1,price:o&&a||0,features:[`${g.questions.length} comprehensive questions`,"Detailed explanations and answers","Curated by AI experts","Updated content","Multiple difficulty levels"]},{data:h,error:v}=await (0,l.addAInterviewSheetToDB)(m);if(v||!h)return console.error("Error saving interview sheet:",v),s.status(500).json({success:!1,message:"Failed to save interview sheet to database",error:v});let w=g.questions.map(async(e,s)=>{try{let t={title:e.title||e.question?.substring(0,100)||`Question ${s+1}`,question:e.question||"",answer:e.answer||"",frequency:e.frequency||"Asked Frequently",priority:e.priority||"Medium",companyTypes:e.company_types||["Startup","MNC"]},r=await u().post(`${process.env.API_URL}/interview-prep/${h._id}/question`,t,{headers:{"Content-Type":"application/json"}});return r.data}catch(e){return console.error(`Error adding question ${s+1}:`,e),null}}),f=await Promise.allSettled(w),q=f.filter(e=>"fulfilled"===e.status&&e.value).length,x=f.length-q;console.log(`Interview sheet uploaded: ${h._id}`),console.log(`Questions added: ${q}/${f.length}`),x>0&&console.warn(`Failed to add ${x} questions`);try{await u().delete(`${d}/interview/session/${t}`)}catch(e){console.warn("Failed to cleanup session:",e)}return s.status(200).json({success:!0,message:"Interview sheet uploaded successfully",data:{sheetId:h._id,name:h.name,questionsAdded:q,totalQuestions:f.length,slug:h.slug}})}catch(e){if(console.error("Interview sheet upload error:",e),u().isAxiosError(e)){if(e.response?.status===404)return s.status(404).json({success:!1,message:"Session not found in The-Boring-Agents"});if(e.response?.status===400)return s.status(400).json({success:!1,message:e.response.data?.message||"Invalid request to The-Boring-Agents"})}return s.status(500).json({success:!1,message:"Internal server error during upload",error:void 0})}}let d=(0,a.l)(r,"default"),p=(0,a.l)(r,"config"),c=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/v1/interview-prep/upload",pathname:"/api/v1/interview-prep/upload",bundlePath:"",filename:""},userland:r})}};var s=require("../../../../webpack-api-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[4222,5912,5166,9276,3300],()=>__webpack_exec__(1593));module.exports=t})();