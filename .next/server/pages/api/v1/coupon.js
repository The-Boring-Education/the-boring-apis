"use strict";(()=>{var e={};e.id=3780,e.ids=[3780],e.modules={8097:e=>{e.exports=require("@sentry/nextjs")},2167:e=>{e.exports=require("axios")},3582:e=>{e.exports=require("cors")},1185:e=>{e.exports=require("mongoose")},1649:e=>{e.exports=require("next-auth/react")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3160:e=>{e.exports=require("next/dist/lib/import-next-warning")},5828:e=>{e.exports=require("uuid")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2147:(e,t,r)=>{r.r(t),r.d(t,{config:()=>l,default:()=>c,routeModule:()=>R});var s={};r.r(s),r.d(s,{default:()=>p});var u=r(1802),a=r(7153),n=r(6249),o=r(5912),i=r(3300),E=r(5166),d=r(3506);let handler=async(e,t)=>{if(await (0,E.D0)(e,t),"OPTIONS"===e.method){t.status(200).end();return}let r=await (0,d.xM)(e,t);if(!r)return;await (0,d.uD)();let{method:s}=e;switch(s){case"GET":return handleGetAllCoupons(t);case"POST":return handleCreateCoupon(e,t);default:return t.status(o.uT.METHOD_NOT_ALLOWED).json((0,E.OF)({status:o.uT.BAD_REQUEST,message:`Method ${s} not allowed`}))}},handleGetAllCoupons=async e=>{try{let{data:t,error:r}=await (0,i.getAllCouponsFromDB)();if(r)return e.status(o.uT.INTERNAL_SERVER_ERROR).json((0,E.OF)({status:o.uT.BAD_REQUEST,message:r}));return e.status(o.uT.OKAY).json((0,E.OF)({status:o.uT.OKAY,message:"Coupons fetched successfully",data:t}))}catch(t){return console.error("Error fetching coupons:",t),e.status(o.uT.INTERNAL_SERVER_ERROR).json((0,E.OF)({status:o.uT.BAD_REQUEST,message:"Internal server error while fetching coupons"}))}},handleCreateCoupon=async(e,t)=>{try{let{code:r,discountPercentage:s,description:u,isActive:a=!0,expiryDate:n,maxUsage:d,minimumAmount:p=0,applicableProducts:c=[]}=e.body;if(!r||!u||null==s||!n)return t.status(o.uT.BAD_REQUEST).json((0,E.OF)({status:o.uT.BAD_REQUEST,message:"Code, description, discountPercentage, and expiryDate are required"}));if(s<1||s>100)return t.status(o.uT.BAD_REQUEST).json((0,E.OF)({status:o.uT.BAD_REQUEST,message:"Discount percentage must be between 1 and 100"}));let l=new Date(n);if(l<=new Date)return t.status(o.uT.BAD_REQUEST).json((0,E.OF)({status:o.uT.BAD_REQUEST,message:"Expiry date must be in the future"}));let R=e.headers["x-admin-user-id"]||"000000000000000000000000",T={code:r.trim().toUpperCase(),discountPercentage:s,description:u.trim(),isActive:a,expiryDate:l,maxUsage:d,minimumAmount:p,applicableProducts:c,createdBy:R},{data:_,error:x}=await (0,i.createCouponFromDB)(T);if(x)return t.status(o.uT.BAD_REQUEST).json((0,E.OF)({status:o.uT.BAD_REQUEST,message:x}));return t.status(o.uT.RESOURCE_CREATED).json((0,E.OF)({status:o.uT.RESOURCE_CREATED,message:"Coupon created successfully",data:_}))}catch(e){return console.error("Error creating coupon:",e),t.status(o.uT.INTERNAL_SERVER_ERROR).json((0,E.OF)({status:o.uT.INTERNAL_SERVER_ERROR,message:"Internal server error while creating coupon"}))}},p=handler,c=(0,n.l)(s,"default"),l=(0,n.l)(s,"config"),R=new u.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/v1/coupon",pathname:"/api/v1/coupon",bundlePath:"",filename:""},userland:s})},3506:(e,t,r)=>{r.d(t,{D0:()=>s.D0,uD:()=>s.uD,xM:()=>s.xM});var s=r(7750)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,5912,5166,9276,7750,3300],()=>__webpack_exec__(2147));module.exports=r})();