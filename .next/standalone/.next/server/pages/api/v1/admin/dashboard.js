"use strict";(()=>{var e={};e.id=6085,e.ids=[6085],e.modules={8097:e=>{e.exports=require("@sentry/nextjs")},2167:e=>{e.exports=require("axios")},3582:e=>{e.exports=require("cors")},1185:e=>{e.exports=require("mongoose")},1649:e=>{e.exports=require("next-auth/react")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3160:e=>{e.exports=require("next/dist/lib/import-next-warning")},5828:e=>{e.exports=require("uuid")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},86:(e,t,a)=>{a.r(t),a.d(t,{config:()=>p,default:()=>m,routeModule:()=>g});var s={};a.r(s),a.d(s,{default:()=>c});var r=a(1802),o=a(7153),u=a(6249),n=a(5912),d=a(3300),i=a(5166),l=a(3506);let formatDateToIST=e=>{let t=new Date(e.toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),a=t.toLocaleString("en-US",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"Asia/Kolkata"}),s=Math.floor((Date.now()-t.getTime())/864e5);return{readableTime:`${s} Days Ago | ${t.getDate()} ${t.toLocaleString("default",{month:"short",timeZone:"Asia/Kolkata"})} | ${a}`,daysAgo:s,istDate:t}},handler=async(e,t)=>{if(await (0,i.D0)(e,t),"OPTIONS"===e.method){t.status(200).end();return}await (0,l.uD)();let{method:a,query:s}=e,{type:r="overview",page:o="1",limit:u="20"}=s;return"GET"!==a?t.status(n.uT.METHOD_NOT_ALLOWED).json((0,i.OF)({status:!1,message:`Method ${a} not allowed`})):handleAdminDashboard(t,r,parseInt(o),parseInt(u))},handleAdminDashboard=async(e,t,a,s)=>{try{let mapUserLearningProgress=(e,t)=>e.map(e=>{let a="course"===t?e.chapters?.filter(e=>e.isCompleted).length||0:void 0,s="course"===t?e.chapters?.length||0:void 0,r=new Date(e.updatedAt),o=new Date(e.createdAt),u=formatDateToIST(r),n=formatDateToIST(o);return{_id:e._id,user:{userId:e.userId?._id,userName:e.userId?.name,userEmail:e.userId?.email,userContactNo:e.userId?.contactNo},[t]:e[`${t}Id`],completedChapters:a,totalChapters:s,isCompleted:e.isCompleted,certificateId:e.certificateId,lastUpdated:u.readableTime,createdAt:n.readableTime}});switch(t){case"overview":{let[t,a,s,r,o,u,l]=await Promise.all([(0,d.getTotalCountFromModel)(d.User),(0,d.getTotalCountFromModel)(d.Course),(0,d.getTotalCountFromModel)(d.UserCourse),(0,d.getTotalCountFromModel)(d.Project),(0,d.getTotalCountFromModel)(d.UserProject),(0,d.getTotalCountFromModel)(d.InterviewSheet),(0,d.getTotalCountFromModel)(d.UserSheet)]);return e.status(n.uT.OKAY).json((0,i.OF)({status:!0,data:{totalUsers:t.data||0,totalCourses:a.data||0,coursesEnrolled:s.data||0,totalProjects:r.data||0,projectsEnrolled:o.data||0,totalSheets:u.data||0,sheetsEnrolled:l.data||0}}))}case"users":{let{data:{items:t},error:r}=await (0,d.getAllDocumentsFromModel)(d.User,a,s,[],{updatedAt:-1});if(r)return e.status(n.uT.INTERNAL_SERVER_ERROR).json((0,i.OF)({status:!1,error:r,message:"Failed to fetch users"}));let o=await d.User.countDocuments(),u=Math.ceil(o/s);return e.status(n.uT.OKAY).json((0,i.OF)({status:!0,data:{items:t.map(e=>{let t=formatDateToIST(new Date(e.updatedAt)),a=formatDateToIST(new Date(e.createdAt));return{_id:e._id,name:e.name,userName:e.userName,email:e.email,contactNo:e.contactNo,isOnboarded:e.isOnboarded,occupation:e.occupation,purpose:e.purpose?.join(", ")||"",lastUpdated:t.readableTime,createdAt:a.readableTime}}),total:o,currentPage:a,totalPages:u}}))}case"user-courses":{let{data:{items:t},error:r}=await (0,d.getAllDocumentsFromModel)(d.UserCourse,a,s,[{path:"courseId",select:"name slug coverImageURL"},{path:"userId",select:"name email contactNo"}],{updatedAt:-1});if(r)return e.status(n.uT.INTERNAL_SERVER_ERROR).json((0,i.OF)({status:!1,error:r,message:"Failed to fetch user courses"}));let o=mapUserLearningProgress(t,"course"),u=await d.UserCourse.countDocuments(),l=Math.ceil(u/s);return e.status(n.uT.OKAY).json((0,i.OF)({status:!0,data:{items:o,total:u,currentPage:a,totalPages:l}}))}case"user-projects":{let{data:{items:t},error:r}=await (0,d.getAllDocumentsFromModel)(d.UserProject,a,s,[{path:"projectId",select:"name slug coverImageURL"},{path:"userId",select:"name email contactNo"}],{updatedAt:-1});if(r)return e.status(n.uT.INTERNAL_SERVER_ERROR).json((0,i.OF)({status:!1,error:r,message:"Failed to fetch user projects"}));let o=mapUserLearningProgress(t,"project"),u=await d.UserProject.countDocuments(),l=Math.ceil(u/s);return e.status(n.uT.OKAY).json((0,i.OF)({status:!0,data:{items:o,total:u,currentPage:a,totalPages:l}}))}case"user-sheets":{let{data:{items:t},error:r}=await (0,d.getAllDocumentsFromModel)(d.UserSheet,a,s,[{path:"sheetId",select:"name slug coverImageURL"},{path:"userId",select:"name email contactNo"}],{updatedAt:-1});if(r)return e.status(n.uT.INTERNAL_SERVER_ERROR).json((0,i.OF)({status:!1,error:r,message:"Failed to fetch user sheets"}));let o=mapUserLearningProgress(t,"sheet"),u=await d.UserSheet.countDocuments(),l=Math.ceil(u/s);return e.status(n.uT.OKAY).json((0,i.OF)({status:!0,data:{items:o,total:u,currentPage:a,totalPages:l}}))}default:return e.status(n.uT.BAD_REQUEST).json((0,i.OF)({status:!1,message:"Invalid admin dashboard type"}))}}catch(t){return e.status(n.uT.INTERNAL_SERVER_ERROR).json((0,i.OF)({status:!1,error:t,message:"Unexpected error in admin dashboard API"}))}},c=handler,m=(0,u.l)(s,"default"),p=(0,u.l)(s,"config"),g=new r.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/v1/admin/dashboard",pathname:"/api/v1/admin/dashboard",bundlePath:"",filename:""},userland:s})},3506:(e,t,a)=>{a.d(t,{D0:()=>s.D0,uD:()=>s.uD,xM:()=>s.xM});var s=a(7750)}};var t=require("../../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222,5912,5166,9276,7750,3300],()=>__webpack_exec__(86));module.exports=a})();