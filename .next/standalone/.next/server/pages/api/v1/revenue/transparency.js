"use strict";(()=>{var e={};e.id=989,e.ids=[989],e.modules={8097:e=>{e.exports=require("@sentry/nextjs")},2167:e=>{e.exports=require("axios")},3582:e=>{e.exports=require("cors")},1185:e=>{e.exports=require("mongoose")},1649:e=>{e.exports=require("next-auth/react")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3160:e=>{e.exports=require("next/dist/lib/import-next-warning")},5828:e=>{e.exports=require("uuid")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},7730:(e,t,a)=>{a.r(t),a.d(t,{config:()=>m,default:()=>c,routeModule:()=>x});var r={};a.r(r),a.d(r,{default:()=>l});var s=a(1802),u=a(7153),n=a(6249),o=a(5912),i=a(3300),d=a(5166),p=a(3506);let handler=async(e,t)=>{if(await (0,d.D0)(e,t),"OPTIONS"===e.method){t.status(200).end();return}await (0,p.uD)();let{method:a}=e;return"GET"===a?handleGetRevenueData(e,t):t.status(o.uT.BAD_REQUEST).json((0,d.OF)({status:!1,message:`Method ${e.method} Not Allowed`}))},handleGetRevenueData=async(e,t)=>{try{let e=await i.Payment.find({isPaid:!0}).sort({createdAt:-1}).populate("user","name email").select("amount createdAt user productType orderId").lean(),a=await i.PrepYatraSubscription.find({isActive:!0}).sort({createdAt:-1}).populate("userId","name email").select("amount createdAt userId type").lean(),r=[...e.map(e=>({id:e._id,amount:e.amount,date:e.createdAt||new Date,user:e.user,type:e.productType||"TBE_Course",orderId:e.orderId})),...a.map(e=>({id:e._id,amount:e.amount,date:e.createdAt||new Date,user:e.userId,type:"PrepYatra_Subscription",subscriptionType:e.type}))].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),s=r.reduce((e,t)=>e+t.amount,0),u=r.length>=5&&s>=2e3;if(!u)return t.status(o.uT.OKAY).json((0,d.OF)({status:!0,data:{showData:!1,message:"Revenue data not yet available for public display"},message:"Revenue transparency criteria not met"}));let n=r.slice(0,5).map(e=>({id:e.id,amount:e.amount,date:e.date,type:e.type,userInitials:e.user?.name?e.user.name.split(" ").map(e=>e[0]).join("").toUpperCase():"U"}));return t.status(o.uT.OKAY).json((0,d.OF)({status:!0,data:{showData:!0,totalRevenue:s,totalTransactions:r.length,recentTransactions:n,stats:{totalPrepYatraRevenue:a.reduce((e,t)=>e+t.amount,0),totalTBERevenue:e.reduce((e,t)=>e+t.amount,0),totalPrepYatraSubscriptions:a.length,totalTBEPurchases:e.length}},message:"Revenue data retrieved successfully"}))}catch(e){return console.error("Error getting revenue data:",e),t.status(o.uT.INTERNAL_SERVER_ERROR).json((0,d.OF)({status:!1,message:"Failed to get revenue data",error:e.message}))}},l=handler,c=(0,n.l)(r,"default"),m=(0,n.l)(r,"config"),x=new s.PagesAPIRouteModule({definition:{kind:u.x.PAGES_API,page:"/api/v1/revenue/transparency",pathname:"/api/v1/revenue/transparency",bundlePath:"",filename:""},userland:r})},3506:(e,t,a)=>{a.d(t,{D0:()=>r.D0,uD:()=>r.uD,xM:()=>r.xM});var r=a(7750)}};var t=require("../../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222,5912,5166,9276,7750,3300],()=>__webpack_exec__(7730));module.exports=a})();